<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üåç Block Charity + Disaster Alert</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;}
body{font-family:'Inter',sans-serif;margin:0;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);background-size:cover;color:
#fff;background-image: url("clone.jpg");display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:40px 20px;}
.wrap{width:100%;max-width:960px;animation:fadeIn 1s ease;}
h1{
  text-align:center;
  font-size:2.2rem;
  background:linear-gradient(45deg,#00c6ff,#ff6ec7);
  -webkit-background-clip:text;
  background-clip:text;
  -webkit-text-fill-color:transparent;
  color:transparent;
  animation:glow 3s infinite alternate ease-in-out;
}
.grid{display:grid;grid-template-columns:1fr 380px;gap:20px;}
@media(max-width:900px){.grid{grid-template-columns:1fr;}}
.card{background:rgba(255,255,255,0.05);border-radius:14px;padding:18px;backdrop-filter:blur(12px);margin-bottom:16px;box-shadow:0 10px 35px rgba(0,0,0,0.4);transition:transform 0.3s, box-shadow 0.3s;}
.card:hover{transform:translateY(-5px);box-shadow:0 15px 45px rgba(0,255,255,0.4);}
label{display:block;font-size:0.88rem;margin-top:8px;color:#e0efff;}
input,select,button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;font-size:1rem;}
input,select{background:rgba(255,255,255,0.08);color:#fff;}
input::placeholder{color:#ccc;}
button.primary{background:linear-gradient(45deg,#00c6ff,#0072ff);color:#fff;font-weight:600;cursor:pointer;transition:all .3s;}
button.primary:hover{transform:scale(1.05);}
button.muted{background:rgba(255,255,255,0.08);color:#eee;}
#chatLog{min-height:150px;white-space:pre-wrap;background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;margin-top:12px;font-size:0.95rem;color:#e8f6ff;}
#typing{font-style:italic;color:#cfe9ff;display:none;margin-top:8px;}
/* Popup Styles */
#donPopup {
  display:none;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(6px);
  justify-content:center; align-items:center; z-index:1000;
  animation:fadeIn 0.3s ease;
}
.popup-content {
  background:linear-gradient(135deg,#00c6ff,#ff6ec7);
  padding:24px; border-radius:16px;
  text-align:center; color:#fff; min-width:280px;
  box-shadow:0 15px 40px rgba(0,0,0,0.6);
  animation:scaleIn 0.3s ease;
}
.popup-actions { display:flex; justify-content:space-around; margin-top:20px; }
.popup-actions button{ width:40%; }
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes glow{from{text-shadow:0 0 6px #00c6ff;}to{text-shadow:0 0 26px #ff6ec7;}}
@keyframes scaleIn{from{transform:scale(0.7);}to{transform:scale(1);}}
</style>
</head>
<body>
<div class="wrap">
<h1>üåç Block Charity + Disaster Alerts</h1>
<div class="grid">
<!-- Left Column -->
<div>
<!-- Wallet -->
<div class="card">
<strong>üîó Wallet</strong>
<p id="walletChip">Not connected</p>
<button class="primary" id="connectBtn">Connect Wallet</button>
<button class="muted" id="disconnectBtn">Disconnect</button>
</div>
<!-- Chatbot -->
<div class="card">
<strong>ü§ñ Chatbot Assistant</strong>
<label>Language</label>
<select id="lang">
<option value="en">English</option>
<option value="hi">Hindi</option>
<option value="kn">Kannada</option>
<option value="ta">Tamil</option>
<option value="es">Spanish</option>
</select>
<label>Ask something</label>
<input id="chatMsg" placeholder="Type or use üé§..." />
<div style="margin-top:8px;">
<button id="sendBtn" class="primary">üí¨ Send</button>
<button id="micBtn" class="muted">üé§ Speak</button>
<button id="clearBtn" class="muted">üßπ Clear</button>
</div>
<p id="typing">Bot is typing...</p>
<div id="chatLog">‚ú® Welcome! Ask me about NGOs, donations, or alerts.</div>
</div>
</div>
<!-- Right Column -->
<div>
<!-- Donation -->
<div class="card" id="donateCard">
<strong>üí∏ Donate to NGO</strong>
<input id="donorId" placeholder="Donor ID" />
<input id="ngoId" placeholder="NGO ID" />
<input id="disasterId" placeholder="Disaster ID (ex: FLOOD-2025)" />
<input id="donAmount" placeholder="Amount (ETH)" />
<button class="primary" id="donateBtn">Donate Now</button>
<p id="donStatus"></p>

<!-- Popup -->
<div id="donPopup" class="popup">
  <div class="popup-content">
    <h3>Confirm Donation</h3>
    <p id="popupMsg"></p>
    <div class="popup-actions">
      <button id="confirmBtn" class="primary">‚úÖ Confirm</button>
      <button id="cancelBtn" class="muted">‚ùå Cancel</button>
    </div>
  </div>
</div>
</div>
<!-- Disaster Alert -->
<div class="card">
<h3>‚ö†Ô∏è Disaster Alert</h3>
<label>Type</label>
<select id="alertType"><option>Flood</option><option>Earthquake</option><option>Cyclone</option></select>
<label>Location</label><input id="alertLocation" placeholder="Ex: Kerala" />
<label>Severity</label><select id="alertSeverity"><option>Advisory</option><option>Warning</option><option>Emergency</option></select>
<button class="primary" id="genAlert">üö® Generate Alert</button>
<div id="alertsList" style="margin-top:12px;font-size:0.9rem;"></div>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
// --- DOM ---
const connectBtn=document.getElementById('connectBtn');
const disconnectBtn=document.getElementById('disconnectBtn');
const walletChip=document.getElementById('walletChip');
const sendBtn=document.getElementById('sendBtn');
const clearBtn=document.getElementById('clearBtn');
const micBtn=document.getElementById('micBtn');
const chatLog=document.getElementById('chatLog');
const typingEl=document.getElementById('typing');
const chatMsg=document.getElementById('chatMsg');
const langEl=document.getElementById('lang');
const donateBtn=document.getElementById('donateBtn');
const donStatus=document.getElementById('donStatus');
const genAlertBtn=document.getElementById('genAlert');
const alertsList=document.getElementById('alertsList');

const donPopup=document.getElementById("donPopup");
const popupMsg=document.getElementById("popupMsg");
const confirmBtn=document.getElementById("confirmBtn");
const cancelBtn=document.getElementById("cancelBtn");

let account=null, web3, contract, recognition, listening=false;


const langMap={en:{sr:'en-US',tts:'en-US'},hi:{sr:'hi-IN',tts:'hi-IN'},kn:{sr:'kn-IN',tts:'kn-IN'},ta:{sr:'ta-IN',tts:'ta-IN'},es:{sr:'es-ES',tts:'es-ES'}};
const responses = {
en:{hello:"Hello üëã How can I help you?",ngo:"We have 200+ verified NGOs ‚úÖ.",donate:"Please enter NGO ID and donation amount below üí∏.",fallback:"‚ú® I‚Äôm still learning!"},
ta:{hello:"‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç üëã ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ§‡Æµ‡Æ≤‡Ææ‡ÆÆ‡Øç?",ngo:"‡Æ®‡ÆÆ‡Æï‡Øç‡Æï‡ØÅ 200+ ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü NGOs ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ© ‚úÖ.",donate:"‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ NGO ‡Æê‡Æü‡Æø ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡Æ§‡Øä‡Æï‡Øà‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç üí∏.",fallback:"‚ú® ‡Æ®‡Ææ‡Æ©‡Øç ‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ±‡Øç‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç!"},
hi:{hello:"‡§®‡§Æ‡§∏‡•ç‡§§‡•á üëã ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",ngo:"‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏ 200+ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ NGOs ‡§π‡•à‡§Ç ‚úÖ‡•§",donate:"‡§ï‡•É‡§™‡§Ø‡§æ NGO ID ‡§î‡§∞ ‡§¶‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç üí∏‡•§",fallback:"‚ú® ‡§Æ‡•à‡§Ç ‡§Ö‡§≠‡•Ä ‡§∏‡•Ä‡§ñ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å!"},
kn:{hello:"‡≤π‡≤≤‡≥Ü‡≥Ç‡≥ï üëã ‡≤®‡≤æ‡≤®‡≥Å ‡≤π‡≥á‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤¨‡≤π‡≥Å‡≤¶‡≥Å?",ngo:"‡≤®‡≤Æ‡≤ó‡≥Ü 200+ ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤§ NGOs ‡≤á‡≤∞‡≥Å‡≤µ‡≤µ‡≥Å ‚úÖ.",donate:"‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å NGO ID ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¶‡≤æ‡≤® ‡≤Æ‡≥ä‡≤§‡≥ç‡≤§‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø üí∏.",fallback:"‚ú® ‡≤®‡≤æ‡≤®‡≥Å ‡≤á‡≤®‡≥ç‡≤®‡≥Ç ‡≤ï‡≤≤‡≤ø‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü!"},
es:{hello:"¬°Hola üëã! ¬øC√≥mo puedo ayudarte?",ngo:"Tenemos m√°s de 200 ONG verificadas ‚úÖ.",donate:"Por favor ingrese el ID de la ONG y la cantidad üí∏.",fallback:"‚ú® ¬°Todav√≠a estoy aprendiendo!"}
};

// --- Contract ---
const contractAddress="0x66c44ea75458c67d8a2cbc3c8c9dbf9f3030cede"; 
const abi=[ 
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "donorId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "ngoId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "disasterId",
				"type": "string"
			}
		],
		"name": "donate",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "donor",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "donorId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "ngoId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "disasterId",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "DonationReceived",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address payable",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "balances",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "contractBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "ngoId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getDonation",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "ngoId",
				"type": "uint256"
			}
		],
		"name": "getDonationsCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "ngoDonations",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "donorId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "ngoId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "disasterId",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];


connectBtn.addEventListener("click", async ()=>{
  if(window.ethereum){
    try{
      const accounts=await ethereum.request({method:'eth_requestAccounts'});
      account=accounts[0];
      walletChip.textContent=`Connected: ${account.slice(0,6)}...${account.slice(-4)}`;
      web3=new Web3(window.ethereum);
      contract=new web3.eth.Contract(abi,contractAddress);
    }catch(e){alert("‚ö† Wallet connection failed");}
  }else alert("Install MetaMask");
});
disconnectBtn.addEventListener("click",()=>{account=null; walletChip.textContent="Not connected";});


async function sendMessage(){
  const msg=chatMsg.value.trim(); const uiLang=langEl.value;
  if(!msg) return; appendLog("You: "+msg); chatMsg.value=''; typingEl.style.display='block';
  setTimeout(()=>{
    typingEl.style.display='none';
    const res=responses[uiLang]||responses.en;
    let reply;
    if(msg.toLowerCase().includes("hello")||msg.includes("‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç")||msg.includes("‡§®‡§Æ‡§∏‡•ç‡§§‡•á")) reply=res.hello;
    else if(msg.toLowerCase().includes("ngo")||msg.includes("NGO")) reply=res.ngo;
    else if(msg.toLowerCase().includes("donate")||msg.includes("‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà")||msg.includes("‡§¶‡§æ‡§®")) reply=res.donate;
    else reply=res.fallback;
    appendLog("Bot: "+reply); speakText(reply,uiLang);
  },1000);
}
sendBtn.addEventListener('click',sendMessage);
chatMsg.addEventListener('keydown',e=>{if(e.key==='Enter') sendMessage();});
clearBtn.addEventListener('click',()=>{chatLog.textContent="‚ú® Welcome! Ask me about NGOs, donations, or alerts.";});
function appendLog(t){chatLog.textContent+="\n"+t; chatLog.scrollTop=chatLog.scrollHeight;}
function speakText(text,uiLang){if(!('speechSynthesis'in window))return; const u=new SpeechSynthesisUtterance(text); u.lang=langMap[uiLang]?.tts||'en-US'; speechSynthesis.cancel(); speechSynthesis.speak(u);}


function setupRecognition(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition; if(!SR){micBtn.disabled=true; return;}
  recognition=new SR(); recognition.interimResults=false;
  recognition.onresult=e=>{chatMsg.value=e.results[0][0].transcript; sendBtn.click();};
  recognition.onend=()=>{listening=false; micBtn.textContent="üé§ Speak";};
}
setupRecognition();
micBtn.addEventListener('click',()=>{if(!recognition)return;if(!listening){recognition.lang=langMap[langEl.value]?.sr;recognition.start();listening=true;micBtn.textContent="‚èπ Stop";}else{recognition.stop();}});


donateBtn.addEventListener("click", async () => {
  if (!account) { donStatus.textContent = "‚ö† Connect wallet first!"; return; }

  const donorId = Number(document.getElementById("donorId").value);
  const ngoId = Number(document.getElementById("ngoId").value);
  const disasterId = document.getElementById("disasterId").value.trim();
  const amountEth = parseFloat(document.getElementById("donAmount").value);

  if (!donorId || !ngoId || !disasterId || !amountEth) { donStatus.textContent = "‚ö† Fill all fields!"; return; }

  popupMsg.textContent = `You are about to donate ${amountEth} ETH to NGO #${ngoId} for ${disasterId}.`;
  donPopup.style.display = "flex";
});
cancelBtn.addEventListener("click", ()=>{donPopup.style.display="none";});
confirmBtn.addEventListener("click", async ()=>{
  donPopup.style.display = "none";
  donStatus.textContent = "‚è≥ Processing transaction...";
  const donorId = Number(document.getElementById("donorId").value);
  const ngoId = Number(document.getElementById("ngoId").value);
  const disasterId = document.getElementById("disasterId").value.trim();
  const amountEth = parseFloat(document.getElementById("donAmount").value);
  const amountWei = web3.utils.toWei(amountEth.toString(),"ether");

  try{
    const gasEstimate = await contract.methods.donate(donorId, ngoId, disasterId).estimateGas({ from: account, value: amountWei });
    await contract.methods.donate(donorId, ngoId, disasterId).send({ from: account, value: amountWei, gas: gasEstimate });

    donStatus.textContent = `‚úÖ Donated ${amountEth} ETH to NGO #${ngoId}`;
    appendLog(`Bot: Donation successful to NGO #${ngoId}!`);
    speakText("Donation successful!", langEl.value);

    const card = document.getElementById("donateCard");
    card.style.transform = "scale(1.03)";
    card.style.boxShadow = "0 15px 45px rgba(0,255,255,0.7)";
    setTimeout(()=>{card.style.transform="scale(1)"; card.style.boxShadow="";},800);
  }catch(err){
    donStatus.textContent = "‚ùå Transaction failed: " + (err.message || err);
    console.error(err);
  }
});

// --- Disaster Alerts ---
genAlertBtn.addEventListener("click",async()=>{
  if(!account){alert("Connect wallet first!");return;}
  const type=document.getElementById("alertType").value;
  const loc=document.getElementById("alertLocation").value||"Unknown";
  const sev=document.getElementById("alertSeverity").value;
  const timestamp=new Date().toLocaleString();
  const alertMsg=`üö® Disaster Alert\nType:${type}\nLocation:${loc}\nSeverity:${sev}\nTime:${timestamp}`;
  try{
    const signature=await ethereum.request({method:"personal_sign",params:[alertMsg,account]});
    const div=document.createElement("div"); div.innerHTML=`<b>${type}</b> at <b>${loc}</b> [${sev}]<br>üïí ${timestamp}<br>‚úç ${signature.slice(0,20)}...`;
    alertsList.prepend(div);
    appendLog("Bot: New signed alert generated!"); speakText("New signed alert generated!",langEl.value);
  }catch(err){alert("‚ùå Alert signing failed");}
});
</script>
</body>
  </html>
